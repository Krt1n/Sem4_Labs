1. Find the number of students in each course.

SELECT course_id, COUNT(ID) AS num_students
FROM Takes
GROUP BY course_id;

COURSE_I NUM_STUDENTS
-------- ------------
HIS-351             1
EE-181              1
CS-101              7
CS-347              2
FIN-201             1
CS-319              2
BIO-101             1
PHY-101             1
CS-315              2
CS-190              2
MU-199              1

COURSE_I NUM_STUDENTS
-------- ------------
BIO-301             1

12 rows selected.

2. Find those departments where the average number of students are greater than 10.  

SELECT dept_name FROM student
GROUP BY dept_name having count(dept_name)>10;

3. Find the total number of courses in each department.  
SELECT dept_name,count(course_id) FROM course GROUP BY dept_name;

DEPT_NAME            COUNT(COURSE_ID)
-------------------- ----------------
Elec. Eng.                          1
Physics                             1
Comp. Sci.                          5
Finance                             1
Biology                             3
History                             1
Music                               1

4. Find the names and average salaries of all departments whose average salary is 
greater than 42000.  

SELECT dept_name, AVG(salary) FROM Instructor
GROUP BY dept_name
HAVING AVG(salary) > 42000;

5. Find the enrolment of each section that was offered in Spring 2009.  
SELECT course_id, sec_id, COUNT(ID) AS enrolment
FROM Takes
WHERE semester = 'Spring' AND year = 2009
GROUP BY course_id, sec_id;

COURSE_I SEC_ID    ENROLMENT
-------- -------- ----------
EE-181   1                 1
CS-190   2                 2

6. List all the courses with prerequisite courses, then display course id in increasing 
order.  

SELECT course_id, prereq_id
FROM Prereq
GROUP BY course_id, prereq_id
ORDER BY course_id ASC;

COURSE_I PREREQ_I
-------- --------
BIO-301  BIO-101
BIO-399  BIO-101
CS-190   CS-101
CS-315   CS-101
CS-319   CS-101
CS-347   CS-101
EE-181   PHY-101


7. Display the details of instructors sorting the salary in decreasing order.   
SELECT *
FROM Instructor
ORDER BY salary DESC;

8. Find the maximum total salary across the departments. 

SELECT MAX(total_salary) AS max_total_salary
FROM (
    SELECT dept_name, SUM(salary) AS total_salary
    FROM Instructor
    GROUP BY dept_name
);

MAX_TOTAL_SALARY
----------------
          232000

9. Find the average instructors’ salaries of those departments where the average 
salary is greater than 42000. 

SELECT dept_name, avg_salary
FROM (
    SELECT dept_name, AVG(salary) AS avg_salary
    FROM Instructor
    GROUP BY dept_name
)WHERE avg_salary > 42000;

10. Find the sections that had the maximum enrolment in Spring 2010  

SELECT MAX(total)
FROM (
    SELECT sec_id, COUNT(*) AS total
    FROM takes
    WHERE semester = 'Spring'
      AND year = 2010
    GROUP BY sec_id
) maximum;

11. Find the names of all instructors who teach all students that belong to ‘CSE’ 
department.  

SELECT name
FROM Instructor i
WHERE NOT EXISTS (
    SELECT ID
    FROM Student s
    WHERE s.dept_name = 'CSE'
      AND (s.ID) NOT IN (
          SELECT k.ID
          FROM Takes k, Teaches t
          WHERE t.id = i.id
            AND k.course_id = t.course_id
            AND k.sec_id = t.section_id
            AND k.semester = t.semester
            AND k.year = t.year
      )
);



12. Find the average salary of those department where the average salary is greater 
than 50000 and total number of instructors in the department are more than 5. 

SELECT dept_name, avg_salary
FROM (
    SELECT dept_name, AVG(salary) AS avg_salary, COUNT(ID) AS num_instructors
    FROM Instructor
    GROUP BY dept_name
) WHERE avg_salary > 50000 AND num_instructors > 5;


13. Find all departments with the maximum budget. 

SELECT dept_name, budget
FROM Department
WHERE budget = (
    SELECT MAX(budget)
    FROM Department
);

14. Find all departments where the total salary is greater than the average of the total 
salary at all departments.  

WITH dept_salaries AS (
    SELECT dept_name, SUM(salary) AS total_salary
    FROM Instructor
    GROUP BY dept_name
),
avg_total AS (
    SELECT AVG(total_salary) AS avg_salary
    FROM dept_salaries
)
SELECT dept_name
FROM dept_salaries, avg_total
WHERE total_salary > avg_salary;

15. Transfer all the students from CSE department to IT department.
SAVEPOINT before_transfer;

UPDATE Student
SET dept_name = 'IT'
WHERE dept_name = 'CSE';


ROLLBACK TO before_transfer;
COMMIT;





